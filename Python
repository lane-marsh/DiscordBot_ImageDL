import discord
import os

intents = discord.Intents.default()
intents.message_content = True
client = discord.Client(intents=intents)
counter = 0


@client.event
async def on_ready():
    print('Bot is ready.')


@client.event
async def on_message(message):
    global counter  # Use the counter variable from the outer scope

    if message.author == client.user:
        return

    if message.channel.id == 1127790022502912120 and message.attachments:
        # Assuming YOUR_CHANNEL_ID is the ID of the specific channel where you want the bot to trigger
        attachment = message.attachments[0]  # Assuming only one attachment per message

        # Get the download path from the message
        download_path = 'C:\Users\Fryt5\Pictures\Digital Patterns'

        # Create the download path directory if it doesn't exist
        os.makedirs(download_path, exist_ok=True)

        # Download the image
        response = await attachment.read()
        if response:
            # Determine the file extension based on the attachment's filename
            original_extension = attachment.filename.split('.')[-1]

            # Determine the desired file format
            if original_extension.lower() == 'png':
                file_extension = 'png'
            else:
                file_extension = 'jpg'

            # Increment the counter
            counter += 1

            # Format the filename with the counter value
            filename = f'Pattern-{counter:04d}.{file_extension}'
            filepath = os.path.join(download_path, filename)
            with open(filepath, 'wb') as file:
                file.write(response)

            await message.channel.send(f'Image downloaded and saved as {filepath}')


# Replace 'YOUR_BOT_TOKEN' with your actual bot token
client.run('YOUR_BOT_TOKEN')
